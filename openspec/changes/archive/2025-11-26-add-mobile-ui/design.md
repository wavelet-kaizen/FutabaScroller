# Design: スマートフォン向けタッチ操作UI

## 概要

FloatingControlPanel のUIを洗練されたモダンなデザインに改善する。統一されたカード型パネルとアイコンベースのボタンで、直感的で使いやすいインターフェースを提供する。

## FloatingControlPanel UI仕様

### 表示モード（3段階）

#### 1. 最小化モード（minimized）
```
┌─────┐
│ ⚡ │  ← アイコンのみの円形ボタン
└─────┘
```
- **サイズ**: 48x48px の円形
- **アイコン**: ⚡（稲妻マーク、スクロール/スピードを象徴）
- **動作**: タップで次のモード（status）へ遷移

#### 2. ステータス表示モード（status）
```
┌────────────────────────────┐
│ ⚡ │ 2025/11/26 19:06:17   │
│    │ 速度: 1.5x  ▶ 再生中  │
│    │ [メッセージ表示領域]   │
└────────────────────────────┘
```
- **構成**: アイコン + ステータス情報を横並び表示
- **ステータス情報**:
  - 日時: `YYYY/MM/DD HH:MM:SS` 形式
  - 速度: `X.Xx` 倍速表示
  - 再生状態: `▶ 再生中` または `⏸ 一時停止中`
- **メッセージ表示**: ステータスと同時表示（切り替えボタンを廃止）
- **動作**: タップで次のモード（full）へ遷移

#### 3. フルコントロールモード（full）
```
┌──────────────────────────────┐
│ ⚡ │ 2025/11/26 19:06:17     │
│    │ 速度: 1.5x  ▶ 再生中    │
│    │ [メッセージ表示領域]     │
│    ├─────────────────────────┤
│    │  ⏸  │  －  │  ＋      │  ← 操作ボタン
└──────────────────────────────┘
```
- **構成**: ステータス表示 + 操作ボタン
- **操作ボタン**（アイコンベース）:
  - 再生/一時停止: `▶` / `⏸`
  - 速度ダウン: `－`
  - 速度アップ: `＋`
- **動作**: タップで最小化モードへ遷移（サイクル完了）

### レイアウト構造

```
container (display: flex, flex-direction: row)
├─ mainButton (円形アイコンボタン: ⚡)
└─ contentArea (display: flex, flex-direction: column)
   │  ※最小化時は非表示
   │
   ├─ statusArea (display: flex, flex-direction: column, gap: 4px)
   │  ├─ timeText (日時)
   │  └─ stateRow (display: flex, flex-direction: row, gap: 12px)
   │     ├─ speedText (速度)
   │     └─ playStateText (再生状態アイコン付き)
   │
   ├─ messageArea (メッセージがある場合のみ表示)
   │  └─ messageText
   │
   └─ controlsArea (display: flex, flex-direction: row, gap: 6px)
      │  ※fullモード時のみ表示
      │
      ├─ playPauseButton (⏸ または ▶)
      ├─ speedDownButton (－)
      └─ speedUpButton (＋)
```

### アイコン仕様

#### メインアイコン（UIボタン）
- **採用**: `⚡` 稲妻（スピード/スクロールを象徴）
- 代替案: `↕` 上下矢印、`⟳` 円形矢印

#### 再生状態アイコン
- **再生中**: `▶` 右向き三角形
- **一時停止中**: `⏸` 一時停止マーク

#### 操作ボタンアイコン
- **再生/一時停止ボタン**: `▶` / `⏸`（状態に応じて切り替え）
- **速度ダウン**: `－` マイナス記号
- **速度アップ**: `＋` プラス記号

### デザイン仕様

#### カラーパレット
```css
/* 背景 */
--panel-bg: rgba(22, 24, 28, 0.95);

/* アクセントカラー */
--accent-blue: #4c9eff;

/* テキスト */
--text-primary: #e8eaed;
--text-secondary: #9aa0a6;

/* ボタン */
--button-bg: rgba(76, 158, 255, 0.15);
--button-hover: rgba(76, 158, 255, 0.25);
--button-active: rgba(76, 158, 255, 0.35);

/* エラー表示 */
--error-color: #ff6b6b;
```

#### サイズ仕様
- **最小化モード**: 48x48px（円形）
- **ステータス/フルモード**: 幅 280px、高さ自動調整
- **ボタンサイズ**: 44x44px（タッチしやすいサイズ）
- **メインアイコンボタン**: 40x40px（円形）

#### スペーシング
```css
/* パネル */
--panel-padding: 12px;
--content-gap: 8px;

/* ボタン */
--button-gap: 6px;

/* ステータステキスト */
--status-gap: 4px;
--state-row-gap: 12px;

/* メッセージエリア */
--message-padding: 8px;
--message-margin-top: 6px;
```

#### シャドウ・エフェクト
```css
/* パネルシャドウ */
box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);

/* ボタンシャドウ */
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);

/* メッセージボックス背景 */
background: rgba(255, 255, 255, 0.06);
border-radius: 6px;
```

#### タイポグラフィ
```css
/* フォントファミリー */
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;

/* フォントサイズ */
--font-size-time: 13px;
--font-size-state: 12px;
--font-size-message: 12px;
--font-size-button: 18px;  /* アイコン用 */
```

#### アニメーション
```css
/* モード切り替え時のトランジション */
transition: all 0.2s ease-out;

/* ボタンホバー時 */
transition: background-color 0.15s ease;

/* ドラッグ中のカーソル */
cursor: grabbing;  /* ドラッグ中 */
cursor: grab;      /* 通常時 */
```

### 改善点まとめ

1. **統一されたパネル**: 全てのコントロールを1つのカード型パネルに集約
2. **メッセージ切り替え廃止**: ステータスとメッセージを同時表示
3. **アイコンベースのボタン**: 言語に依存しない直感的な操作
4. **視覚的階層**: アイコン、ステータス、操作ボタンの明確な区別
5. **タップしやすいサイズ**: 最小44x44pxでモバイルフレンドリー
6. **滑らかなアニメーション**: 状態遷移時の視覚的フィードバック

### 技術的考慮事項

#### ドラッグ処理
- タップとドラッグの区別: ドラッグ距離が5px以下ならタップと判定
- `event.preventDefault()` でスクロール干渉を防止
- 画面境界を考慮した位置制限

#### パフォーマンス
- DOM要素の再利用（表示/非表示の切り替えのみ）
- テキスト更新時のみ再レンダリング
- イベントリスナーの適切な登録/解除

#### アクセシビリティ
- `button` 要素の使用（スクリーンリーダー対応）
- `data-role` 属性でテスト可能性を確保
- 十分なコントラスト比の確保

## 実装上の注意点

### メッセージ表示の統合
- `showMessage()` 呼び出し時、メッセージを `statusArea` の下に常駐表示
- `messageToggle` ボタンを削除
- `showMessageView` 状態フラグを削除（常に表示）

### ステータスレイアウト
- 日時と速度・再生状態を縦並びで整理
- 速度と再生状態は横並び（同じ行に表示）
- 各要素のスペーシングを統一

### ボタンスタイル
- テキストではなくUnicode記号を使用
- `font-size: 18px` で視認性を確保
- ホバー・アクティブ状態の視覚的フィードバックを追加

### z-index管理
- パネル: `12000`
- 既存の `StatusOverlay` や `SpeedOverlay` より上位に配置
